# TrackLater

Forgot to track your time for work? TrackLater helps you track time after-the-fact by combining clues and showing your day on a simple timeline view.

The initial version supports fetching clues from
* [Thyme](https://github.com/sourcegraph/thyme)
* Git
* Slack

Time entries can be exported to
* Toggl

Issues and projects/clients can be fetched from
* Jira
* Taiga
* Toggl (projects/clients)


# Implementation notes

Every module separates their issues, time-entries and projects by *group*. This makes inter-module communication simple: e.g. commits made in the git repository for *group* x will be attributed to the corresponding Toggl project for *group* x.

*Groups* are arbitrary and decided by the user when creating their settings file. A good way to choose your amount of *group*s
is to create a *group* for each client/work project.

While all modules are optional, an important backbone for TimeLater is [thyme](https://github.com/sourcegraph/thyme).
The thyme module assumes an implementation where every day is stored in a file named `YYYY-MM-DD.json`. It's recommended to set up an automatic thyme tracking script for this.

I'm using a basic script to run thyme. It has evolved a bit after about a year of tracking: Sometimes thyme fails tracking and corrupts the whole file,
so I definitely recommend using this script. https://gist.github.com/Eerovil/36d109d531659d24bfafea7111b12e90

To run thyme automatically every 20 seconds you can add this to your crontab. Windows users can probably use services (don't quote me on this).
```
* * * * * DISPLAY=:0 /home/eero/Documents/thyme/track-thyme-log.sh
* * * * * ( sleep 20; DISPLAY=:0 /home/eero/Documents/thyme/track-thyme-log.sh )
* * * * * ( sleep 40; DISPLAY=:0 /home/eero/Documents/thyme/track-thyme-log.sh )
```

# Running

Example command to start the server. Must be run in the `tracklater` directory (containing `app.py`)
```
FLASK_APP=app.py FLASK_ENV=development WERKZEUG_DEBUG_PIN=off python -m flask run
```

# Settings guide

Each module has their own settings dict, containing a settings dict for each group. There is also
a `global` key for non-group specific settings.

This example settings file contains two groups: 'group1' and 'group2'. In the example workers workflow,
group1's issues are fetched from Jira while group2's issues are from Taiga.io. Time tracking (for billing) is done through
Toggl. Also, both groups happen to have their own workspaces on slack, and obviously their own git repositories.

```
ENABLED_MODULES = [
    'thyme',
    'gitmodule',
    'toggl',
    'taiga',
    'jira',
    'slack'
]

# Toggl module supports a single login using an api key.

TOGGL = {
    'global': {
        API_KEY: 'your-api-key'
    },
    'group1': {
        # NAME Must match the client name on toggl
        'NAME': 'First Group',
        'PROJECTS': {
            # PROJECTS Keys must match the project name on toggl.
            # Values contain a project type, currently unused.
            'Development': 'default',
            'Bug fixing': 'bug',
        }
    },
    'group2': {
        'NAME': 'Second Group',
        'PROJECTS': {
            'Development': 'default',
            'Bug fixing': 'default',
        }
    }
}

GIT = {
    'global': {
        # Only commits made by users with EMAILS will be shown
        'EMAILS': ['firstname.lastname@email.com'],
    },
    'group1': {
        # Full path to the git repo
        'REPOS': ['/full/path/to/group1/repo']
    },
    'group2': {
        'REPOS': ['/full/path/to/group2/repo']
    },
}

JIRA = {
    'group1': {
        # Each group must have these settings
        'CREDENTIALS': ('username', 'password'),
        'URL': 'https://group1.atlassian.net',
        'PROJECT_KEY': 'DEV',
    }
}

TAIGA = {
    'global': {
        'CREDENTIALS': ['username', 'password']
    },
    'group2': {
        # project_slug can be found in the URL
        'project_slug': 'username-group2'
    }
}

THYME = {
    'global': {
        # Directory containing the json files generated by thyme
        'DIR': '/full/path/to/thyme/dir',
    }
}

SLACK = {
    # Each group should contain a workspace to match all messager to a group
    'global': {
        # Global catch-all workspace for all groups
        'API_KEY': 'legacy-slack-api-key-global',
        'USER_ID': 'your-user-id',
    },
    'group2': {
        # Messages in this workspace will be matched to group2
        'API_KEY': 'legacy-slack-api-key-group2',
        'USER_ID': 'your-user-id',
    }
}

```
